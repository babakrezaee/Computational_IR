<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Naive Bayes – Computational International Relations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./TreeModels.html" rel="next">
<link href="./knn.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./NaiveBayes.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Naive Bayes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational International Relations</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">K-Nearest Neighbors (KNN)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NaiveBayes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Naive Bayes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TreeModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tree Models: Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HW1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Homework 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#a-brief-introduction-to-probability-theory" id="toc-a-brief-introduction-to-probability-theory" class="nav-link active" data-scroll-target="#a-brief-introduction-to-probability-theory"><span class="header-section-number">3.1</span> A Brief Introduction to Probability Theory</a></li>
  <li><a href="#bayes-theorem" id="toc-bayes-theorem" class="nav-link" data-scroll-target="#bayes-theorem"><span class="header-section-number">3.2</span> Bayes’ Theorem</a></li>
  <li><a href="#naive-bayes-classification" id="toc-naive-bayes-classification" class="nav-link" data-scroll-target="#naive-bayes-classification"><span class="header-section-number">3.3</span> Naive Bayes Classification</a></li>
  <li><a href="#an-example-spam-or-ham" id="toc-an-example-spam-or-ham" class="nav-link" data-scroll-target="#an-example-spam-or-ham"><span class="header-section-number">3.4</span> An example: Spam or Ham?</a></li>
  <li><a href="#cleaning-up-the-data" id="toc-cleaning-up-the-data" class="nav-link" data-scroll-target="#cleaning-up-the-data"><span class="header-section-number">3.5</span> Cleaning up the data</a></li>
  <li><a href="#splitting-data-into-train-and-test" id="toc-splitting-data-into-train-and-test" class="nav-link" data-scroll-target="#splitting-data-into-train-and-test"><span class="header-section-number">3.6</span> Splitting Data into Train and Test</a></li>
  <li><a href="#naive-bayes-and-missclassification" id="toc-naive-bayes-and-missclassification" class="nav-link" data-scroll-target="#naive-bayes-and-missclassification"><span class="header-section-number">3.7</span> Naive Bayes and Missclassification</a></li>
  <li><a href="#the-caret-package-a-streamlined-approach-to-training-algorithms" id="toc-the-caret-package-a-streamlined-approach-to-training-algorithms" class="nav-link" data-scroll-target="#the-caret-package-a-streamlined-approach-to-training-algorithms"><span class="header-section-number">3.8</span> <strong>The caret Package: A Streamlined Approach to Training Algorithms</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Naive Bayes</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In a scientific research, we cannot prove our theoretical model is <em>true</em>. However, we can investigate what is the <em>probablity</em> that our theoretical model is <em>not true</em>. To measure and quantify this uncertainty, we employ probability theorem and statistics.</p>
<section id="a-brief-introduction-to-probability-theory" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="a-brief-introduction-to-probability-theory"><span class="header-section-number">3.1</span> A Brief Introduction to Probability Theory</h2>
<p>In social science, we are interested in studying the variations in one, sometime a set of, outcome across time and/or location: inter-state war, civil war, housing price, gender inequality, election results, and so forth. We often show this outcome variable, aka dependent variable, with <span class="math inline">\(Y\)</span>. Roughly speaking, a theory/hypothesis/proposition explain the association between the outcome variable <span class="math inline">\(Y\)</span> with another random variable that is called explanatory variable, aka independent variable, exogenous variable, and feature, and is often shown by <span class="math inline">\(X\)</span>.</p>
<p>Virtually, all statistical methods employed by social scientists aims to find and explain what is the probability of observing a specific outcome <span class="math inline">\(Y=y\)</span> given a specific value of independent variable <span class="math inline">\(X=x\)</span>. We can write this as: <span class="math inline">\(P(Y=y|X=x)\)</span>. Some simply write this as <span class="math inline">\(P(y|x)\)</span>. As you will see in this course, and you might saw it in your other advanced methods course, the statistical techniques and algorithms that we use can be mainly divided to two groups based on whether <span class="math inline">\(Y\)</span> is continuous or discrete/categorical. The latter one is often called classification question. (<strong><em>note:</em></strong> <em>do not mix classification with clustering. These are two different types of problems. We will discuss clustering in the final sessions of this course.</em>)</p>
<p>The common practice in studying <span class="math inline">\(P(Y=y|X=x)\)</span> directly by making an assumption about the functional form of the association between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>. For instance, in linear regression models such as <em>OLS</em>, we assume that the association between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> is linear: <span class="math inline">\(y=\alpha+\beta x+\epsilon\)</span>. That said, you do not have to use probability models to develop a statistical learning model. You also can develop an algorithm and explore its performance. In fact, you can develop any algorithm you want, but you need to show that it works. <span class="math inline">\(k\)</span> nearest neighbors (<em>kNN</em>) is one of these algorithms that does not need any probability model; we will cover <em>kNN</em> in this course. There is also another approach to study <span class="math inline">\(P(Y=y|X=x)\)</span> using the <em>Bayes Theorem</em>, which is the topic of this session.</p>
<p>We will first briefly review very basic probability notations and concepts, then will learn the <em>Bayes Theorem</em>, and finally will study the <em>Naive Bayes</em> algorithm.</p>
<section id="discrete-random-variables" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="discrete-random-variables"><span class="header-section-number">3.1.1</span> Discrete Random Variables</h3>
<p>We are uncertain about the value of a random variable. Thus, we use a (statistical) distribution to describe it. A discrete random variable can only take a countable number of values, and a <em>probability distribution</em> shows the probability of realization of each value/outcome. For example, if we toss a fair coin twice, then the distribution of the number of heads (X) can be written as follow:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(X\)</span></th>
<th style="text-align: center;"><span class="math inline">\(P(X=x)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.25\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.5\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.25\)</span></td>
</tr>
</tbody>
</table>
<p><strong>Question:</strong> What is <span class="math inline">\(P(X \geq 1)\)</span>? What is <span class="math inline">\(P(X &gt; 1)\)</span>?</p>
</section>
<section id="probability-massdenisty-function-and-cumulative-denisty-function" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="probability-massdenisty-function-and-cumulative-denisty-function"><span class="header-section-number">3.1.2</span> Probability mass/denisty function and cumulative denisty function</h3>
<p><span class="math inline">\(f(x)=P(X=x)\)</span> is known as the probability mass function (PMF) when <span class="math inline">\(X\)</span> is discrete, and the probability density function (PDF) when <span class="math inline">\(X\)</span> is continuous. Also, the cumulative density function (CDF) is</p>
<p><span class="math display">\[F(x)=\sum_{k\leq x}f(k)~~if~~x \in \mathbb{Z}\]</span></p>
<p>and</p>
<p><span class="math display">\[F(x)=\int_{k\leq x}f(k)~~if~~x \in \mathbb{R}.\]</span></p>
<p>Some of the commonly used distributions are <span class="math inline">\(X\sim N(\mu,\sigma)\)</span>, <span class="math inline">\(X\sim Bernoulli(p)\)</span>, and <span class="math inline">\(X\sim Poisson(\lambda)\)</span>.</p>
</section>
<section id="conditional-joint-and-marginal-distributions" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="conditional-joint-and-marginal-distributions"><span class="header-section-number">3.1.3</span> Conditional, joint, and marginal distributions</h3>
<ul>
<li><strong>Joint (Probability) Distribution:</strong> Probability of observing two (or more) outcomes together is measured using joint probability distribution written as: <span class="math inline">\(P(X=x, Y=y)\)</span>. Of course, it can be extended to more than two outcomes:</li>
</ul>
<p><span class="math display">\[P(X_1=x_1,X_2=x_2,\dots,X_N=x_N)\]</span>.</p>
<ul>
<li><strong>Conditional (Probability) Distribution:</strong> Intuitively, this means how knowing the values/outcomes of some variables affect our understanding about the values/outcomes of other variables. The simplest version of it for a two-variable case is P(Y=y|X=x), and the extended version of it is:</li>
</ul>
<p><span class="math display">\[P(Y_1=y_1,Y=y_2,...,Y_L=y_L|X_1=x_1,X_2=x_2,\dots,X_M=x_M).\]</span></p>
<p>Suppose that we are interested in modeling the type of contentious politics,<span class="math inline">\(\{0=Peace, 1=Nonviolent~Protests, 2=Violent~Protests, 3=Civil~War\}\)</span>, in The Republic of Gilead<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> next year given the economic condition. For the sake of simplicity assume that there are two economic conditions: boom and bust.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">\(S\)</span></th>
<th style="text-align: center;"><span class="math inline">\(P(S=s\|C=boom)\)</span></th>
<th style="text-align: center;"><span class="math inline">\(S\)</span></th>
<th style="text-align: center;"><span class="math inline">\(P(S=s\|C=bust)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Peace</td>
<td style="text-align: center;"><span class="math inline">\(.80\)</span></td>
<td style="text-align: center;">Peace</td>
<td style="text-align: center;"><span class="math inline">\(.50\)</span></td>
</tr>
<tr class="even">
<td>Nonviolent Protests</td>
<td style="text-align: center;"><span class="math inline">\(.15\)</span></td>
<td style="text-align: center;">Nonviolent Protests</td>
<td style="text-align: center;"><span class="math inline">\(.25\)</span></td>
</tr>
<tr class="odd">
<td>Violent Protests</td>
<td style="text-align: center;"><span class="math inline">\(.03\)</span></td>
<td style="text-align: center;">Violent Protests</td>
<td style="text-align: center;"><span class="math inline">\(.20\)</span></td>
</tr>
<tr class="even">
<td>Civil war</td>
<td style="text-align: center;"><span class="math inline">\(.02\)</span></td>
<td style="text-align: center;">Civil war</td>
<td style="text-align: center;"><span class="math inline">\(.05\)</span></td>
</tr>
</tbody>
</table>
<p>We read P(S=Violent protests|E=bust)=.20: The probability/likelihood of “Violent protests” (S=Violent protests) conditional on/given a bad economy(C=bust) is <span class="math inline">\(.20\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/s/i9w11kvqhr63jez/Bayes_TreeExample.jpg?dl=1" class="img-fluid figure-img"></p>
<figcaption>Outcome tree</figcaption>
</figure>
</div>
<p>There are eight outcomes whose probabilities are conditional on the economic conditions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\((C, S)\)</span></th>
<th style="text-align: center;"><span class="math inline">\(P(S=s, C=c)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\((Boom, Peace)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.16\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\((Boom, Nonviolent)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.07\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\((Boom, Violent)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.006\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\((Boom, Civil~War)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.004\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\((Bust, Peace)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.4\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\((Bust, Nonviolent)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.2\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\((Bust, Violent)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.16\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\((Bust, Civil~War)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(.04\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="how-are-conditional-joint-and-marginal-probabilities-related" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="how-are-conditional-joint-and-marginal-probabilities-related"><span class="header-section-number">3.1.4</span> How are conditional, joint, and marginal probabilities related?</h3>
<p>Joint and conditional probabilities:</p>
<p><span class="math display">\[\begin{align} \label{standardization}
P(Y=y,X=x)=P(X=x)P(Y=y|X=x)\\
          =P(Y=y)P(X=x|Y=y)
\end{align}\]</span></p>
<p>Joint and marginal probabilities:</p>
<p><span class="math display">\[\begin{align}
P(X=x)=\sum_y Pr(X=x,Y=y) \\
P(Y=y)=\sum_x Pr(X=x,Y=y)
\end{align}\]</span></p>
<p><strong>Finding condtional probabilities from joints</strong></p>
<p>Here is the two-way probability table of above example.</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Probability Distribution of Economic and Conflict Scenarios</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Category</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Peace</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Non_violent</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Violent</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Civil_War</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bust</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.160</td>
<td style="text-align: right;">0.040</td>
<td style="text-align: right;">0.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Boom</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.166</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">1.0</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<ul>
<li>What is the <em>probability of civil war outcome</em>?</li>
<li>What is the <em>probability of civil war outcome knowing that the economy</em> is busting?</li>
</ul>
<p>Solution: we can formally write these two questions as</p>
<p><span class="math inline">\(P(S=Civil~War)=?\)</span> and <span class="math inline">\(P(S=Civil~War|E=Bust)=?\)</span></p>
<p><span class="math display">\[\begin{align}
P(S=Civil~War) = \sum_{e \in E} P(S=Civil~War,E=e) \\
               = P(S=Civil~War,E=Bust)\\
               +P(S=Civil~War,E=Boost)\\
               = .04+.004=.044
\end{align}\]</span></p>
<p>To find <span class="math inline">\(P(S=Civil~War|E=Bust)\)</span>, we can use <span class="math inline">\(P(Y=y,X=x)=P(X=x)P(Y=y|X=x)\)</span>:</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Probability Distribution of Economic and Conflict Scenarios</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Category</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Peace</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Non_violent</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Violent</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Civil_War</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">Bust</td>
<td style="text-align: right; background-color: rgba(211, 211, 211, 255) !important;">0.40</td>
<td style="text-align: right; background-color: rgba(211, 211, 211, 255) !important;">0.20</td>
<td style="text-align: right; background-color: rgba(211, 211, 211, 255) !important;">0.160</td>
<td style="text-align: left; background-color: rgba(211, 211, 211, 255) !important;">extcolor{red}{0.04}</td>
<td style="text-align: right; background-color: rgba(211, 211, 211, 255) !important;">0.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Boom</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: left;">0.004</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.166</td>
<td style="text-align: left;">0.044</td>
<td style="text-align: right;">1.0</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><span class="math display">\[\begin{align}
P(S=Civil~War|E=Bust) = \frac{P(S=Civil~War,E=Bust)}{p(E=Bust)}\\
                      =  \frac{.04}{.8}=.05=5\%
\end{align}\]</span></p>
</section>
</section>
<section id="bayes-theorem" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="bayes-theorem"><span class="header-section-number">3.2</span> Bayes’ Theorem</h2>
<p>We are interested in finding <span class="math inline">\(P(y|x)\)</span>, and the common practice by <em>frequentist</em> statisticians is assuming a functional form for the association between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, and then estimating the parameters of the function using different methods such as <em>OLS</em>, <em>MLE</em>, and so forth. However, there is another approach based on <em>Bayes’ Theorem</em>:</p>
<p><span class="math display">\[\begin{align}
P(y|x)=\frac{P(x,y)}{p(x)}=\frac{P(x,y)}{\sum_y p(x,y)}=\frac{p(y)p(x|y)}{\sum_y p(y)p(x|y)}
\end{align}\]</span></p>
<p>In other words, we can say Bayes’ Theorem suggest computing <span class="math inline">\(P(y|x)\)</span> from <span class="math inline">\(P(y)\)</span> and <span class="math inline">\(P(x|y)\)</span>.</p>
<p><strong>Picnic Day Example:</strong> Assume that you are planning to go out for a picnic today. However, you find that the weather is cloudy when you wake up. 50% of rainy days start off cloudy. However, cloudy days are common in your city. 40% of days start cloudy. Further, season it is a dry month, you know that in average 3 of 30 days end to rain, i.e.&nbsp;10%. The question is what is the likelihood of raining today when it starts cloudy/</p>
<p><em>Solution:</em></p>
<p><span class="math display">\[\begin{align}
P(Rain|Cloud)=\frac{P(Cloud|Rain) P(Rain)}{P(Cloud)}
             = \frac{.1 \times .5}{.4}=.125=12.5\%
\end{align}\]</span></p>
<p><strong>Question:</strong> What is the posterior odds ratio if <span class="math inline">\(y={0,1}\)</span>?</p>
<section id="extending-bayes-theorem-to-more-than-two-variables" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="extending-bayes-theorem-to-more-than-two-variables"><span class="header-section-number">3.2.1</span> Extending Bayes’ Theorem to more than two variables</h3>
<p>Often, we face a question which requires modeling more than two variables. We still can extend the relationship between the joint and conditional distributions to more than two variables:</p>
<p><span class="math display">\[\begin{align}
P(Y_1=y_1, Y_2=y_2, Y_3=y_3)= P(Y_1=y_1) P(Y_2=y_2|Y_1=y_1) P(Y_3=y_3|Y_1=y_1, Y_2=y_2)

\end{align}\]</span></p>
</section>
<section id="independence" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="independence"><span class="header-section-number">3.2.2</span> Independence</h3>
<p>Consider a set of random variables, <span class="math inline">\(\{x_1, x_2, \dots, x_k\}\)</span>. They are independent of each other if the conditional distribution of any of them is not dependent on our observation of any others.</p>
<p><strong>Example:</strong> Suppose a fair coin is tossed 20 times. Let <span class="math inline">\(Y_i\)</span> be 1 if the coin is a head at the <span class="math inline">\(i^{th}\)</span> round, and <span class="math inline">\(0\)</span> otherwise. What is <span class="math inline">\(P(Y_{11}=1)\)</span>? What is <span class="math inline">\(P(Y_{11}=1|y_1=1,\dots,y_{10}=1)=?\)</span></p>
<p>If two variables are independent, the the relation between the joint and conditional distributions changes to:</p>
<p><span class="math display">\[\begin{align}

P(Y=y|X=x)=P(Y=y)

\end{align}\]</span></p>
<p>So,</p>
<p><span class="math display">\[\begin{align}

P(Y=y|X=x)=P(Y=y)\\

P(X=x,Y=y)=P(Y=y|X=x) P(X=x)\\
          =P(Y=y)P(X=x)

\end{align}\]</span></p>
<p><strong>Theorem:</strong> <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent if and only if <span class="math inline">\(P(x,y)=P(y|x)P(x)=p(y)p(x)\)</span></p>
</section>
<section id="identical-distributions" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="identical-distributions"><span class="header-section-number">3.2.3</span> Identical distributions</h3>
<p>Another common assumption in statistical analysis is that random variables are distributed <em>identically</em>. This means if we toss a coin 100 times, and <span class="math inline">\(Y_i=1\)</span> and <span class="math inline">\(0\)</span> otherwise, then <span class="math inline">\(P(Y_{30}=1)=P(Y_{85}=1)\)</span>!</p>
<p>When random variables are distributed identically and independently, they are called IID distributions.</p>
</section>
</section>
<section id="naive-bayes-classification" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="naive-bayes-classification"><span class="header-section-number">3.3</span> Naive Bayes Classification</h2>
<p>Despite its other name, “Idiot’s” Bayes Classification, this method often shows a very good classification performance!</p>
<p>Assume that you have a categorical outcome <span class="math inline">\(Y\)</span>. As mentioned above, we are interested in finding <span class="math inline">\(P(y|x)\)</span>, that is what is the probability of <span class="math inline">\(Y\)</span> conditional on observing <span class="math inline">\(X=x\)</span>.</p>
<p>For the sake of simplicity, assume that <span class="math inline">\(Y=\{0,1\}\)</span>. Then, the common practice among political scientists is estimating a logistic regression:</p>
<p><span class="math display">\[
P(y=1|x) \sim Bernoulli(p(x)), p(x)=\frac{e^{x'\beta}}{1+e^{x'\beta}}
\]</span></p>
<p>where <span class="math inline">\(x=(x_1, x_2, \dots, x_p)'\)</span> and <span class="math inline">\(\beta=(\beta_1, \beta_2, \dots, \beta_p)'\)</span>.</p>
<p>However, we can use Bayes Theorem to indirectly compute <span class="math inline">\(P(y|x)\)</span>. Naive Bayes classification makes a simplification assumption, which makes the name of this method <em>naive</em>: the elements of the features/explanatory variables of <span class="math inline">\(X=(X_1, X_2, \dots, X_p)\)</span> are conditionally independent given Y:</p>
<p><span class="math display">\[
p(Y=y|X=x)=\frac{p(X=x|Y=y)p(Y=y)}{p(X=x)}
\]</span> For continuous <span class="math inline">\(x\)</span>, we can re-write:</p>
<p><span class="math display">\[
p(Y=k|X=x)=\frac{\pi_k f_k(x)}{\sum_{l=1}^k f_l(x)}
\]</span></p>
<p>Getting back to the discrete model; for a problem with <span class="math inline">\(X=(X_1, X_2, \dots, X_p)\)</span>, we have:</p>
<p><span class="math display">\[
p(Y=y|X=x)=\frac{p(\{x_1, x_2, \dots, x_p \}|Y=y)p(Y=y)}{p(X=x)}
\]</span></p>
<p>Naive Bayes assumes that <span class="math inline">\(p(\{x_1, x_2, \dots, x_p \}|Y=y)=\prod_i p(x_i|y)\)</span>. Thus,</p>
<p><span class="math display">\[
p(y|x) \propto  p(y)\prod_i p(x_i|y)
\]</span></p>
<p>What is the interpretation of the above formula?</p>
</section>
<section id="an-example-spam-or-ham" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="an-example-spam-or-ham"><span class="header-section-number">3.4</span> An example: Spam or Ham?</h2>
<p>Content and sentiment analysis involve understanding the communicated messages in a text using computational methods. Indeed, the plan is to use a statistical model to train an algorithm to read, process, and analyze the text. Every word in a piece of text can add information about its intended message, tone, and sentiment.</p>
<p>Here, we do a simple analysis of short message texts to categorize them to <em>Spam</em> and <em>Ham</em>. In this example, we use the <em>Bag of Words</em> method which does not consider the order of words, which contain information as well. However, surprisingly, this <em>naive</em> method is still a powerful too, as you see below.</p>
<p>In the <em>Bag of Words</em>, also known as <em>BoW</em>, method, these below texts are considered identical:</p>
<ul>
<li><p>Sentence 1: There will be a presentation on Machine Learning in the school of management</p></li>
<li><p>Sentence 2: Learning will be a on Machine management in the school of There presentation.</p></li>
</ul>
<p>Let’s now do the coding part:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading the data of the web</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>smsData<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/babakrezaee/MethodsCourses/master/DataSets/sms_spam.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">encoding=</span><span class="st">"UTF-8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's take a look at the first few observations</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(smsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  type
1  ham
2  ham
3  ham
4 spam
5 spam
6  ham
                                                                                                                                                               text
1                                                                                                                 Hope you are having a good week. Just checking in
2                                                                                                                                           K..give back my thanks.
3                                                                                                                       Am also doing in cbe only. But have to pay.
4             complimentary 4 STAR Ibiza Holiday or £10,000 cash needs your URGENT collection. 09066364349 NOW from Landline not to lose out! Box434SK38WP150PPM18+
5 okmail: Dear Dave this is your final notice to collect your 4* Tenerife Holiday or #5000 CASH award! Call 09061743806 from landline. TCs SAE Box326 CW25WX 150ppm
6                                                                                                                Aiya we discuss later lar... Pick u up at 4 is it?</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smsData<span class="sc">$</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Length     Class      Mode 
     5559 character character </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(smsData<span class="sc">$</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to change the data type for "type" from text to factor</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>smsData<span class="sc">$</span>type<span class="ot">=</span><span class="fu">factor</span>(smsData<span class="sc">$</span>type)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's look at the data now:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(smsData<span class="sc">$</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> ham spam 
4812  747 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(smsData<span class="sc">$</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NaiveBayes_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.factor</span>(smsData<span class="sc">$</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(smsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5559    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(smsData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "type" "text"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>smsData<span class="sc">$</span>type[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ham  ham  ham  spam spam
Levels: ham spam</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>smsData<span class="sc">$</span>text[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hope you are having a good week. Just checking in"                                                                                                                
[2] "K..give back my thanks."                                                                                                                                          
[3] "Am also doing in cbe only. But have to pay."                                                                                                                      
[4] "complimentary 4 STAR Ibiza Holiday or £10,000 cash needs your URGENT collection. 09066364349 NOW from Landline not to lose out! Box434SK38WP150PPM18+"            
[5] "okmail: Dear Dave this is your final notice to collect your 4* Tenerife Holiday or #5000 CASH award! Call 09061743806 from landline. TCs SAE Box326 CW25WX 150ppm"</code></pre>
</div>
</div>
<p>In this question, the outcome variable is <span class="math inline">\(y=type\)</span>, and the feature is <span class="math inline">\(x=text\)</span>. We can check the frequency of words in the texts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wordcloud</span>(smsData<span class="sc">$</span>text, <span class="at">min.freq =</span> <span class="dv">1</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">max.words=</span><span class="dv">200</span>, <span class="at">random.order=</span><span class="cn">FALSE</span>, <span class="at">rot.per=</span><span class="dv">0</span>, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">colors=</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="NaiveBayes_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cleaning-up-the-data" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="cleaning-up-the-data"><span class="header-section-number">3.5</span> Cleaning up the data</h2>
<p>We need to prepare a corpus of texts, and the corpus needs some cleaning up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>smsCorpus<span class="ot">=</span><span class="fu">VCorpus</span>(<span class="fu">VectorSource</span>(smsData<span class="sc">$</span>text))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>smsCl<span class="ot">=</span><span class="fu">tm_map</span>(smsCorpus,<span class="fu">content_transformer</span>(tolower)) <span class="co"># Change all words from upper to lower letters</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>smsCl<span class="ot">=</span><span class="fu">tm_map</span>(smsCl, removeNumbers)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>smsCl<span class="ot">=</span><span class="fu">tm_map</span>(smsCl, removeWords, <span class="fu">stopwords</span>())</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>smsCl<span class="ot">=</span><span class="fu">tm_map</span>(smsCl, removePunctuation)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>smsCl<span class="ot">=</span><span class="fu">tm_map</span>(smsCl, stemDocument)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>smsCl<span class="ot">=</span><span class="fu">tm_map</span>(smsCl, stripWhitespace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can check how the data turned out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>smsData<span class="sc">$</span>text[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hope you are having a good week. Just checking in"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>smsCl[[<span class="dv">1</span>]]<span class="sc">$</span>content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hope good week just check"</code></pre>
</div>
</div>
<p>The next step is creating a Document Term Matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>smsDTM<span class="ot">=</span><span class="fu">DocumentTermMatrix</span>(smsCl)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(smsDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5559 6559</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.matrix</span>(smsDTM[<span class="dv">100</span><span class="sc">:</span><span class="dv">110</span>,<span class="dv">100</span><span class="sc">:</span><span class="dv">110</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Terms
Docs  admiss admit ador adp adress adrian adrink adsens adult advanc adventur
  100      0     0    0   0      0      0      0      0     0      0        0
  101      0     0    0   0      0      0      0      0     0      0        0
  102      0     0    0   0      0      0      0      0     0      0        0
  103      0     0    0   0      0      0      0      0     0      0        0
  104      0     0    0   0      0      0      0      0     0      0        0
  105      0     0    0   0      0      0      0      0     0      0        0
  106      0     0    0   0      0      0      0      0     0      0        0
  107      0     0    0   0      0      0      0      0     0      0        0
  108      0     0    0   0      0      0      0      0     0      0        0
  109      0     0    0   0      0      0      0      0     0      0        0
  110      0     0    0   0      0      0      0      0     0      0        0</code></pre>
</div>
</div>
<p>You can check the frequent terms in the document as follow. In the example below, we want to find words that occur at least ten times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findFreqTerms</span>(smsDTM, <span class="at">lowfreq =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ask"    "back"   "call"   "can"    "claim"  "come"   "day"    "dear"  
 [9] "dont"   "free"   "friend" "get"    "give"   "good"   "got"    "great" 
[17] "happi"  "hey"    "home"   "hope"   "just"   "know"   "later"  "like"  
[25] "lor"    "love"   "make"   "meet"   "messag" "miss"   "mobil"  "much"  
[33] "need"   "new"    "night"  "now"    "number" "one"    "phone"  "pleas" 
[41] "pls"    "repli"  "say"    "see"    "send"   "sorri"  "still"  "stop"  
[49] "take"   "tell"   "text"   "thank"  "thing"  "think"  "time"   "today" 
[57] "tri"    "txt"    "wait"   "want"   "wat"    "way"    "week"   "well"  
[65] "will"   "work"  </code></pre>
</div>
</div>
</section>
<section id="splitting-data-into-train-and-test" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="splitting-data-into-train-and-test"><span class="header-section-number">3.6</span> Splitting Data into Train and Test</h2>
<p>We divide the data to train and test sub-samples. We first train our algorithm using the train data, then we will evaluate its classifying power on the test data. We learned about cross-validation last session, but let’s for now do a simple one for the sake of training. There will be later assignments for you to explore how this can be done usng cross-vlidation method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>smsTrain<span class="ot">=</span>smsDTM[<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>,]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>smsTest<span class="ot">=</span>smsDTM[<span class="dv">4001</span><span class="sc">:</span><span class="dv">5559</span>,]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>smsTrainY<span class="ot">=</span>smsData[<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>,]<span class="sc">$</span>type</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>smsTestY<span class="ot">=</span>smsData[<span class="dv">4001</span><span class="sc">:</span><span class="dv">5559</span>,]<span class="sc">$</span>type</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training fraction is "</span>,<span class="fu">round</span>((<span class="dv">4000</span><span class="sc">/</span><span class="dv">5559</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"% </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training fraction is  71.96 % </code></pre>
</div>
</div>
<p>As we saw above, there are many words that are repeated in the texts a few times. I will drop all words with frequency of less than 7 times over all texts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>smsWordsFreq<span class="ot">=</span><span class="fu">findFreqTerms</span>(smsTrain,<span class="dv">7</span>) <span class="co"># Words with freq &gt;=7</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>smsFreqTrain<span class="ot">=</span>smsTrain[,smsWordsFreq]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>smsFreqTest<span class="ot">=</span>smsTest[,smsWordsFreq]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>convertCounts <span class="ot">&lt;-</span><span class="cf">function</span>(x){</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="fu">ifelse</span>(x<span class="sc">&gt;</span><span class="dv">0</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># apply() convert_counts() to columns of train/test data</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>smsTrain<span class="ot">=</span><span class="fu">apply</span>(smsFreqTrain, <span class="at">MARGIN =</span> <span class="dv">2</span>, convertCounts)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>smsTest<span class="ot">=</span><span class="fu">apply</span>(smsFreqTest,<span class="at">MARGIN =</span> <span class="dv">2</span>, convertCounts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s check the final version of the prepared data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(smsTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4000  845</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.matrix</span>(smsTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>smsTrain[<span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Terms
Docs abl  abt  accept account across activ actual add  address admir
  10 "No" "No" "No"   "No"    "No"   "No"  "No"   "No" "No"    "No" 
  11 "No" "No" "No"   "No"    "No"   "No"  "No"   "No" "No"    "No" 
  12 "No" "No" "No"   "No"    "No"   "No"  "No"   "No" "No"    "No" </code></pre>
</div>
</div>
</section>
<section id="naive-bayes-and-missclassification" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="naive-bayes-and-missclassification"><span class="header-section-number">3.7</span> Naive Bayes and Missclassification</h2>
<p>Now, we are finally ready to do Naive Bayes classification using <span class="math inline">\({\tt e1071}\)</span> <span class="math inline">\(\mathcal{R}\)</span> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>smsNB<span class="ot">=</span><span class="fu">naiveBayes</span>(smsTrain,smsTrainY, <span class="at">laplace=</span><span class="dv">1</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>yhat<span class="ot">=</span><span class="fu">predict</span>(smsNB,smsTest)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>ctab<span class="ot">=</span><span class="fu">table</span>(yhat,smsTestY)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>ctab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      smsTestY
yhat    ham spam
  ham  1333   19
  spam   19  188</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>missClass<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span>(<span class="fu">sum</span>(ctab)<span class="sc">-</span><span class="fu">sum</span>(<span class="fu">diag</span>(ctab)))<span class="sc">/</span><span class="fu">sum</span>(ctab)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>perSpam<span class="ot">=</span>ctab[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(ctab[,<span class="dv">2</span>])</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Missclassification and Spam classification rate"</span>,<span class="fu">round</span>(missClass,<span class="dv">2</span>),<span class="st">"% and "</span>,<span class="fu">round</span>(perSpam,<span class="dv">2</span>),<span class="st">"%, respectively </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Missclassification and Spam classification rate 0.98 % and  0.91 %, respectively </code></pre>
</div>
</div>
</section>
<section id="the-caret-package-a-streamlined-approach-to-training-algorithms" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="the-caret-package-a-streamlined-approach-to-training-algorithms"><span class="header-section-number">3.8</span> <strong>The caret Package: A Streamlined Approach to Training Algorithms</strong></h2>
<p>The <strong>caret</strong> (<em>Classification and Regression Training</em>) package is one of the most widely used R packages for training machine learning algorithms. It simplifies the process by providing a unified framework for exploring, training, and validating predictive models across a wide range of algorithms.</p>
<p>In the previous section, our trained algorithm was <strong>not cross-validated</strong>, meaning its parameters were not optimized for the highest out-of-sample prediction power. By using <strong>caret</strong>, we can systematically tune our model to improve its generalization performance.</p>
<section id="instructions" class="level3" data-number="3.8.1">
<h3 data-number="3.8.1" class="anchored" data-anchor-id="instructions"><span class="header-section-number">3.8.1</span> <strong>Instructions</strong></h3>
<ol type="1">
<li>Carefully review the complete code below to get an overall understanding of its workflow.</li>
<li>Run the code <strong>line by line</strong> in R.</li>
<li>For the <strong>in-class assignment</strong>, submit an <strong>annotated R script</strong> where you explain what each line of code does.
<ul>
<li>Use <strong>inline comments</strong> (preceded by <code>#</code>) to provide explanations.</li>
<li>Example:</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Hello, students!'</span>)  <span class="co"># This line prints a text message to the console.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello, students!"</code></pre>
</div>
</div>
<p>Now, here is the code for training a <strong>cross-validated Naïve Bayes algorithm</strong> using the same Ham/Spam data set.</p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The Republic of Gilead is the fictional country name in the Handmaid’ tale Tale, Margaret Atwood, 1985.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./knn.html" class="pagination-link" aria-label="K-Nearest Neighbors (KNN)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">K-Nearest Neighbors (KNN)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./TreeModels.html" class="pagination-link" aria-label="Tree Models: Random Forest">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tree Models: Random Forest</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>