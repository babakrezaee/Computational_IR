<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; K-Nearest Neighbors (KNN) – Computational International Relations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./NaiveBayes.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./knn.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">K-Nearest Neighbors (KNN)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational International Relations</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./knn.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">K-Nearest Neighbors (KNN)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NaiveBayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Naive Bayes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Large Language Model (LLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TreeModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tree Models: Random Forest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NetworkAnalysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Network Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HW1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Homework 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./HW2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Homework 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#non-parametric-models" id="toc-non-parametric-models" class="nav-link active" data-scroll-target="#non-parametric-models"><span class="header-section-number">2.1</span> Non-Parametric Models</a></li>
  <li><a href="#a-simple-comparison-of-ols-and-k-nn-boston-housing-example" id="toc-a-simple-comparison-of-ols-and-k-nn-boston-housing-example" class="nav-link" data-scroll-target="#a-simple-comparison-of-ols-and-k-nn-boston-housing-example"><span class="header-section-number">2.2</span> A simple Comparison of OLS and k-NN: Boston Housing Example</a></li>
  <li><a href="#how-does-k-nn-estimate-fcdot" id="toc-how-does-k-nn-estimate-fcdot" class="nav-link" data-scroll-target="#how-does-k-nn-estimate-fcdot"><span class="header-section-number">2.3</span> How Does <span class="math inline">\(K\)</span>-NN Estimate <span class="math inline">\(f(\cdot)\)</span>?</a></li>
  <li><a href="#what-is-the-best-k" id="toc-what-is-the-best-k" class="nav-link" data-scroll-target="#what-is-the-best-k"><span class="header-section-number">2.4</span> What is the “best” K?</a></li>
  <li><a href="#measuring-accuracy" id="toc-measuring-accuracy" class="nav-link" data-scroll-target="#measuring-accuracy"><span class="header-section-number">2.5</span> Measuring Accuracy</a></li>
  <li><a href="#bias-variance-tradeoff" id="toc-bias-variance-tradeoff" class="nav-link" data-scroll-target="#bias-variance-tradeoff"><span class="header-section-number">2.6</span> Bias-Variance Tradeoff</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">2.7</span> Cross-Validation</a></li>
  <li><a href="#k-nearest-neighbors-p1" id="toc-k-nearest-neighbors-p1" class="nav-link" data-scroll-target="#k-nearest-neighbors-p1"><span class="header-section-number">2.8</span> <span class="math inline">\(k\)</span>-Nearest Neighbors, p&gt;1</a></li>
  <li><a href="#a-prediction-problem-with-large-n-and-large-p-using-knn" id="toc-a-prediction-problem-with-large-n-and-large-p-using-knn" class="nav-link" data-scroll-target="#a-prediction-problem-with-large-n-and-large-p-using-knn"><span class="header-section-number">2.9</span> A Prediction Problem with Large <span class="math inline">\(N\)</span> and Large <span class="math inline">\(p\)</span> using <span class="math inline">\(kNN\)</span></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">K-Nearest Neighbors (KNN)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In the social sciences, we are often interested in examining the variation in an outcome variable, <span class="math inline">\(Y\)</span>—also known as the dependent variable—conditional on a set of independent variables, <span class="math inline">\(X\)</span>, which are also referred to as predictors, features, or regressors. This relationship can be formally expressed as:</p>
<p><span class="math display">\[
P(Y=y|X=x)
\]</span> A common strategy for modeling this conditional relationship is to make assumptions about the function, <span class="math inline">\(f(\cdot)\)</span>, that maps <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>, and then estimate its parameters. The <strong>Ordinary Least Squares (OLS)</strong> method is one of the oldest and most important tools for modeling associations between variables. As a <strong>parametric model</strong>, OLS assumes a specific linear relationship between the dependent and independent variables. Under the <strong>classical assumptions of linear regression</strong>, the OLS estimator is considered the <strong>Best Linear Unbiased Estimator (BLUE)</strong>.</p>
<p>However, in many real-world situations, these assumptions do not hold. When this happens, we can take one of two approaches:</p>
<ol type="1">
<li><strong>Stick with the parametric framework</strong> and try to <strong>adjust the model</strong> to account for the violated assumptions. This may involve adding interaction terms, transforming variables, or using regularization techniques.<br>
</li>
<li><strong>Switch to non-parametric models</strong>, which make <strong>fewer assumptions</strong> about the underlying data structure and can flexibly capture complex relationships.</li>
</ol>
<section id="non-parametric-models" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="non-parametric-models"><span class="header-section-number">2.1</span> Non-Parametric Models</h2>
<p>In this context, we introduce the <span class="math inline">\(K\)</span>-Nearest Neighbors (<span class="math inline">\(K\)</span>-NN) algorithm, a classic example of a <em>non-parametric model</em>. Unlike parametric models, <span class="math inline">\(K\)</span>-NN does not assume a specific functional form between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. Instead, it makes predictions based on the <em>similarity</em> between data points, using the values of the <span class="math inline">\(K\)</span> nearest observations to estimate the outcome. While <span class="math inline">\(K\)</span>-NN does not provide insights into the <em>strength</em> or <em>nature</em> of the association between the outcome variable and the predictors, it is often an effective algorithm for <em>prediction</em>, especially when the true relationship between variables is complex or unknown.</p>
</section>
<section id="a-simple-comparison-of-ols-and-k-nn-boston-housing-example" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="a-simple-comparison-of-ols-and-k-nn-boston-housing-example"><span class="header-section-number">2.2</span> A simple Comparison of OLS and k-NN: Boston Housing Example</h2>
<p>The <em>Boston Housing Dataset</em> contains information on housing in the Boston, Massachusetts area in the United States. Suppose we want to predict the <em>median value of a house</em> based on the <em>percentage of the population experiencing socioeconomic disadvantage</em> in a given neighborhood. In the original dataset, this variable is labeled as <em>“lower status,”</em> reflecting the historical language used when the dataset was created in the 1970s. However, modern academic and professional standards call for more thoughtful and respectful terminology when discussing socioeconomic conditions. Therefore, I have <em>relabeled this variable as “socioeconomic disadvantage population”</em> to provide a more accurate and considerate description. The below scatter plot shows how these two variables are associated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="do">## a library of example datasets</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Boston)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lstat,medv,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">'navy'</span>,<span class="at">cex=</span>.<span class="dv">75</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">'Socioeconomic Disadvantage Population(%)'</span>,<span class="at">ylab =</span> <span class="st">'Median Value($)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="linear-model-for-housing-values" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="linear-model-for-housing-values"><span class="header-section-number">2.2.1</span> Linear Model for Housing Values</h3>
<p>To analyze how <em>housing values</em> are associated with the <em>percentage of the population experiencing socioeconomic disadvantage</em> in a neighborhood, we need to define a function that models this relationship. A <em>linear function</em> is often a reasonable starting point. In this case, we assume the following linear model:</p>
<p><span class="math display">\[
Y_i = \alpha + \beta X_i + \varepsilon_i
\]</span> Here, <span class="math inline">\(Y_i\)</span> represents the <strong>housing value</strong>, <span class="math inline">\(X_i\)</span> is the <strong>percentage of socioeconomic disadvantage</strong>, <span class="math inline">\(\alpha\)</span> is the <strong>intercept</strong>, <span class="math inline">\(\beta\)</span> is the <strong>slope coefficient</strong>, and <span class="math inline">\(\varepsilon_i\)</span> is the <strong>error term</strong>.</p>
<p>After estimating the parameters of this model—denoted as <span class="math inline">\(\hat{\alpha}\)</span> and <span class="math inline">\(\hat{\beta}\)</span>—the predicted housing values are given by the <strong>Ordinary Least Squares (OLS)</strong> estimation formula:</p>
<p><span class="math display">\[
\hat{Y}_i = \hat{\alpha} + \hat{\beta} X_i
\]</span></p>
<p>Since we have assumed a <em>linear relationship</em> between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, the fitted prediction line is also linear. This is reflected in the plot below, where the <em>blue line</em> represents the OLS-fitted regression line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lstat,medv,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="st">'grey'</span>,<span class="at">cex=</span>.<span class="dv">75</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">'Socioeconomic Disadvantage Population (%)'</span>,<span class="at">ylab =</span> <span class="st">'Median Value($)'</span>, <span class="at">main=</span><span class="fu">TeX</span>(<span class="st">'$Y=</span><span class="sc">\\</span><span class="st">alpha + </span><span class="sc">\\</span><span class="st">beta X$'</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>lmHousing<span class="ot">=</span><span class="fu">lm</span>(medv<span class="sc">~</span>lstat)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lmHousing<span class="sc">$</span>coef, <span class="at">col=</span><span class="st">"navy"</span>, <span class="at">lwd=</span><span class="fl">2.5</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>yhat_lm25<span class="ot">=</span><span class="fu">predict</span>(lmHousing,<span class="fu">data.frame</span>(<span class="at">lstat=</span><span class="fu">c</span>(<span class="dv">20</span>)))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">20</span>,yhat_lm25,<span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"maroon"</span>, <span class="at">pch=</span><span class="dv">15</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">20</span>,yhat_lm25,<span class="fu">paste</span>(<span class="fu">round</span>(yhat_lm25,<span class="at">digits =</span> <span class="dv">2</span>)),<span class="at">pos=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">"maroon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When using <em>OLS</em> for prediction, we make several key assumptions about the form of the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, denoted as <span class="math inline">\(Y = f(X)\)</span>. These assumptions include linearity, homoscedasticity, independence of errors, and normality of residuals. The same applies to other parametric models, such as <em>Logit</em> and <em>Probit</em>, which assume specific functional forms for modeling binary outcomes.</p>
<p>However, <em>non-parametric approaches</em> impose fewer assumptions on the functional form of <span class="math inline">\(f(X)\)</span>. This flexibility allows them to model complex, non-linear relationships without requiring a predetermined structure. One of the most commonly used non-parametric algorithms is the <span class="math inline">\(K\)</span>-Nearest Neighbors (<span class="math inline">\(K\)</span>-NN) algorithm.</p>
<p>Before diving into the details of this method, let’s first explore how <span class="math inline">\(K\)</span>-NN fits the function <span class="math inline">\(f(\cdot)\)</span> to the data, relying on the proximity of data points rather than predefined functional forms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(MASS) ## a library of example datasets</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#attach(Boston)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kknn) <span class="do">## knn library</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We first need to divide the sample to train (in-sample) and test (out-sample) subsampes. </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">nrow</span>(Boston) <span class="co"># Sample size</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#fit knn with k</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> <span class="fu">data.frame</span>(lstat,medv) <span class="co">#data frame with variables of interest</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#test is data frame with x you want f(x) at, sort lstat to make plots nice.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">lstat =</span> <span class="fu">sort</span>(lstat))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>kf15 <span class="ot">=</span> <span class="fu">kknn</span>(medv<span class="sc">~</span>lstat,train,test,<span class="at">k=</span><span class="dv">15</span>,<span class="at">kernel =</span> <span class="st">"rectangular"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lstat,medv,<span class="at">xlab=</span><span class="st">'Socioeconomic Disadvantage Population (%)'</span>,<span class="at">ylab =</span> <span class="st">'Median Value($)'</span>, <span class="at">col=</span><span class="st">"gray45"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(test<span class="sc">$</span>lstat,kf15<span class="sc">$</span>fitted.values,<span class="at">col=</span><span class="st">"blue"</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>dfp <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">lstat=</span><span class="dv">20</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>kf15_20 <span class="ot">=</span> <span class="fu">kknn</span>(medv<span class="sc">~</span>lstat,train,dfp,<span class="at">k=</span><span class="dv">15</span>,<span class="at">kernel =</span> <span class="st">"rectangular"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"kNN15: the median value of a house in a neighborhood with 20% Socioeconomic Disadvantage Population residents is"</span>,<span class="fu">round</span>(kf15_20<span class="sc">$</span>fitted,<span class="at">digits=</span><span class="dv">2</span>),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>kNN15: the median value of a house in a neighborhood with 20% Socioeconomic Disadvantage Population residents is 14.37 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">20</span>,kf15_20<span class="sc">$</span>fitted,<span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"maroon"</span>, <span class="at">pch=</span><span class="dv">15</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">20</span>,kf15_20<span class="sc">$</span>fitted,<span class="fu">paste</span>(<span class="fu">round</span>(kf15_20<span class="sc">$</span>fitted,<span class="at">digits =</span> <span class="dv">2</span>)),<span class="at">pos=</span><span class="dv">3</span>, <span class="at">cex=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">"maroon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="how-does-k-nn-estimate-fcdot" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="how-does-k-nn-estimate-fcdot"><span class="header-section-number">2.3</span> How Does <span class="math inline">\(K\)</span>-NN Estimate <span class="math inline">\(f(\cdot)\)</span>?</h2>
<p>To estimate <span class="math inline">\(f(\cdot)\)</span> using <span class="math inline">\(K\)</span>-Nearest Neighbors (<span class="math inline">\(K\)</span>-NN), we first need to define a <em>training dataset</em> based on our main sample. The training set for a <span class="math inline">\(K\)</span>-NN algorithm consists of <span class="math inline">\(N\)</span> pairs of <em>features</em> (<span class="math inline">\(x\)</span>) and <em>outcomes</em> (<span class="math inline">\(y\)</span>) as follows:</p>
<p><span class="math display">\[
\{(x_1, y_1), (x_2, y_2), \dots, (x_n, y_n) \}
\]</span></p>
<p>We begin with a <em>single-feature model</em> for simplicity. Later in this handout, we will extend the <span class="math inline">\(K\)</span>-NN algorithm to handle cases with <em>multiple features</em>, where <span class="math inline">\(j &gt; 1\)</span>.</p>
<p>The <span class="math inline">\(K\)</span>-NN algorithm estimates <span class="math inline">\(f(x_i)\)</span> by calculating the <em>average of the outcome values</em> for the <span class="math inline">\(K\)</span> nearest neighbors to <span class="math inline">\(x_i\)</span>. This approach relies on the idea that observations with similar feature values tend to have similar outcomes, allowing <span class="math inline">\(K\)</span>-NN to make predictions without assuming a specific functional form for the data.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-is-the-best-k" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="what-is-the-best-k"><span class="header-section-number">2.4</span> What is the “best” K?</h2>
<p>We learned how K-NN works, but there is an issue here: K is chosen discretionary and for any <span class="math inline">\(K\)</span>, we can get (significantly) different results.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we choose a large <span class="math inline">\(k\)</span>, then we get a simple line such that for k=500, the like is almost the mean of Median House price. On the other hand, choosing a small <span class="math inline">\(k\)</span> gives a volatile estimation which captures the complexity of the data very well, yet it is very sensitive to any small changes in the data. Can we find a middle-way value for <span class="math inline">\(k\)</span>? This is roughly the idea behind using cross-validation to overcome Bias-Variance Trade-Off. To discuss this idea more in detail, we need to learn about interpreting the prediction accuracy of an estimated function.</p>
</section>
<section id="measuring-accuracy" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="measuring-accuracy"><span class="header-section-number">2.5</span> Measuring Accuracy</h2>
<p>For any given feature (<span class="math inline">\(x\in X\)</span>), or the set of features, we can find the predicted value of the outcome variable, <span class="math inline">\(\hat{y}\)</span>, using the estimated function <span class="math inline">\(\hat{f}(x_i)\)</span>. Given this information, we can find the prediction error for each observation by <span class="math inline">\(y_i-\hat{y}_i\)</span>. The prediction error of each statistical model can be calculated using different indices based on these individual errors. One of the most common one is Root Mean Square Error (<em>RMSE</em>).</p>
<p><span class="math display">\[\begin{equation}

RMSE=\sqrt{\frac{1}{n}\sum_{i=1}^n [y_i-\hat{f}(x_i)]^2}

\end{equation}\]</span></p>
<p><em>RMSE</em> calculates the average prediction errors.</p>
<p>Now, let’s calculate the RMSE of predicting Median House Value in Boston Housing data when we use k-NN model, at different levels of k.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bias-variance-tradeoff" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="bias-variance-tradeoff"><span class="header-section-number">2.6</span> Bias-Variance Tradeoff</h2>
<p>Below figure presents one of the core ideas of statistical learning. When the complexity of the model is low, training model has low variance but suffers high bias, which lead to a high prediction error. As the complexity of the model increases, the error of training sample decreases. However, since a model with a high level of complexity is trained to captured biases in the training sample, its prediction power for the test sample decreases, leading to a higher prediction error.</p>
<p>We can model association between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> as follow:</p>
<p><span class="math display">\[\begin{equation}


Y= \underbrace{f(X)}_\text{Signal}+\underbrace{\epsilon}_{Noise}

\end{equation}\]</span></p>
<p><span class="math inline">\(\epsilon\)</span> is the shock component, also known as noise, of the process. The goal of statistical modeling of a process is capturing the changes caused by <span class="math inline">\(f(x)\)</span>, as the shock/noise component is a random process. Thus, we do not want to mistakenly capture the changes caused by the noise part of the model as the changes caused by signal. If we fit a highly complex model which captures/model all changes in the outcome, then the risk of estimating a noisy model increases.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/s/8rgk2omprkhe4nq/BiasVarianceTradeoff_ESL.png?dl=1" class="img-fluid figure-img"></p>
<figcaption>Test and training error as a function of model complexity. (Copied from The Elements of Statistical Learning by Jerome, Friedman, Tibshirani, and Hastie)</figcaption>
</figure>
</div>
<p>Estimating a simple model to explain a complex process leads to a bias function, thought this estimation has a low level of variance. On the other hand, a complex model is sensitive to every bit of changes in the data, which leads to a high variance, though the bias is low.</p>
</section>
<section id="cross-validation" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">2.7</span> Cross-Validation</h2>
<p>Dividing the sample to a train sample and a test sample allows us to evaluate the performance of predictive model. However, there are few challenges regarding this approach:</p>
<ol type="1">
<li><p>How can we be sure that the prediction results are independent of the train set? How can we draw the samples to address this concern?</p></li>
<li><p>Leaving a part of dataset for validating the trained model means that we overlook part of information that we can get from the validation sub-sample. As we overlook this part of information to train our model, we might get a higher level of errors.</p></li>
</ol>
<p>The suggested in statistical learning literature solution to address the above issues is <em>Cross-Validation</em>.</p>
<section id="leave-one-out-cross-validation" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="leave-one-out-cross-validation"><span class="header-section-number">2.7.1</span> Leave-One-Out Cross-Validation</h3>
<p>In this approach, we divide the sample into train and test samples. Assuming that the size of train sample is <span class="math inline">\(n\)</span>, we leave one observation out, say <span class="math inline">\(i^{th}\)</span> observation, and train the model using <span class="math inline">\(n-1\)</span> remaining observations. Then, we predict the outcome of <span class="math inline">\(i^{th}\)</span> observation and compute the amount of prediction error: <span class="math inline">\(RMSE_i=\sqrt{(Y_i-\hat{Y}_i)^2}\)</span>. We repeat this procedure for all observations in the test sample and compute the mean of Cross-Validation RMSE:</p>
<p><span class="math display">\[\begin{equation}

RMSE_{LOCV}=\frac{1}{n}\sum_{i=1}^n RMSE_i

\end{equation}\]</span></p>
</section>
<section id="k-fold-cross-validation" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="k-fold-cross-validation"><span class="header-section-number">2.7.2</span> <span class="math inline">\(k\)</span>-fold Cross Validation</h3>
<p><em>Leave-One-Out Cross-Validation</em> is computationally intensive since you need to repeat the training and evaluation <span class="math inline">\(n\)</span> times. An alternative approach is increasing the number of observations that are left out at each stage. To do so, we can divide the sample randomly to <span class="math inline">\(k\)</span> almost equal size groups; then, we will leave one of these groups out for the validation and use the remaining <span class="math inline">\(k-1\)</span> groups to train the model. Using this training model, we can predict the outcome for the observations in the validation subsample and then calculate the prediction for each of thoes observations. We will iterate the training and validation steps for each group (<span class="math inline">\(k\)</span> times). Below figure shows a schematic view of <span class="math inline">\(k\)</span>-fold Cross-Validation (KCV).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/s/assm8rmbub0frz0/K-fold-cross-validation-E-is-the-overall-error-estimate.png?dl=1" class="img-fluid figure-img"></p>
<figcaption>The photo is borrowed from: https://www.researchgate.net/figure/K-fold-cross-validation-E-is-the-overall-error-estimate_fig3_320270458</figcaption>
</figure>
</div>
<p>Considering the calculated error terms for each observation, we can compute the mean of <span class="math inline">\(RMSE^{KCV}\)</span> as follow:</p>
<p><span class="math display">\[\begin{equation}

RMSE^{KCV}=\sqrt{\frac{1}{n}\sum_{i=1}^n(Y_i-\hat{Y}_i)^2}

\end{equation}\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Lets use the average of 5-,10-, and 15-fol </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The best K is: 34 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="showing-variance-bias-tradeoff-by-an-example" class="level3" data-number="2.7.3">
<h3 data-number="2.7.3" class="anchored" data-anchor-id="showing-variance-bias-tradeoff-by-an-example"><span class="header-section-number">2.7.3</span> Showing Variance-Bias-TradeOff by an Example</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="k-nearest-neighbors-p1" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="k-nearest-neighbors-p1"><span class="header-section-number">2.8</span> <span class="math inline">\(k\)</span>-Nearest Neighbors, p&gt;1</h2>
<p>In the previous sections, we studied the <span class="math inline">\(kNN\)</span> prediction algorithm for the cases where there is only one feature. Finding the <span class="math inline">\(k\)</span> nearest points for a problem with one feature/independent variable is straightforward, but how does the algorithm changes if we want to use more than one feature/independent variable?</p>
<p>The idea of <span class="math inline">\(kNN\)</span> is predicting based on the most similar, closest, observations on the training subsample. Where <span class="math inline">\(p&gt;1\)</span>, the problem is finding the predicted values of <span class="math inline">\(Y_k\)</span> given a set of the features/covariates <span class="math inline">\(X_f=(x_{f1},x_{f2},\dots,x_{fp})\)</span>.</p>
<p><span class="math inline">\(kNN\)</span>:</p>
<p>To predict <span class="math inline">\(\hat{Y}_f\)</span> using <span class="math inline">\(X_f=(x_{f1},x_{f2},\dots,x_{fp})\)</span>, we can define a neighborhood around <span class="math inline">\(X_f\)</span> which include <span class="math inline">\(k\)</span> nearest <span class="math inline">\(X_i\)</span>’s to <span class="math inline">\(X_f\)</span> on the training dataset; then, we calculate the average of <span class="math inline">\(y_i\)</span>’s corresponding to these <span class="math inline">\(k\)</span> smallest <span class="math inline">\(d_i\)</span>.</p>
<p>There are different distance metric. Here, we use one of the most well-known one, that is Euclidean Distance:</p>
<p><span class="math display">\[\begin{equation}

d_{if}=\sqrt{\sum_{j=1}^p (x_{fj}-x_{ij})^2}~, X_i~in~training~data


\end{equation}\]</span></p>
<p>The second issue that we should address in employing <span class="math inline">\(kNN\)</span> for problems with more than one feature is rescaling and normalizing the features.</p>
<p>Let’s take a look at below scatter plots of Median Housing price versus Percentage of lower status of the population, <em>lstat</em>, and Weighted distances to five Boston employment centers, <em>dis</em>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>As you can see in the above photo, the unit of <em>lstat</em> is different from the unit of <em>dis</em>. This different between units of features affect finding the nearest points around <span class="math inline">\(X_f\)</span>. One common solution is rescaling/normalizing the features before applying <span class="math inline">\(kNN\)</span> algorithm. There are two common rescaling approaches:</p>
<ol type="1">
<li></li>
</ol>
<p><span class="math display">\[\begin{equation}

\tilde{x}=\frac{x-min(x)}{max(x)-min(x)}

\end{equation}\]</span></p>
<p>This rescaling formula limit the X’s to <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p>
<ol start="2" type="1">
<li></li>
</ol>
<p><span class="math display">\[\begin{equation}

\tilde{x}=\frac{x-\bar{x}}{\sigma_x}

\end{equation}\]</span></p>
<p>Let’s see how this rescaling changes the correlation between <em>dis</em> and <em>medv</em>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>As you can see in the above graphs, rescaling features does not change the association between the features and the outcome variable.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-prediction-problem-with-large-n-and-large-p-using-knn" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="a-prediction-problem-with-large-n-and-large-p-using-knn"><span class="header-section-number">2.9</span> A Prediction Problem with Large <span class="math inline">\(N\)</span> and Large <span class="math inline">\(p\)</span> using <span class="math inline">\(kNN\)</span></h2>
<p>Now, let’s predict the median price of houses in Boston data using several features. The features that I picked to predict the housing price, <em>medv</em>, are <em>crim,indus,age,dis,black,</em> and <em>lstat</em>. Before estimating the prediction model, it can be helpful to plot the scatter plots showing the association between the outcome and the features.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(Boston)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kknn)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source_url</span>(<span class="st">'https://raw.githubusercontent.com/babakrezaee/DataWrangling/master/Functions/docv_fun.R'</span>) <span class="do">## Cross validation function</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">cbind</span>(crim,indus,age,dis,black,lstat)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>mmsc<span class="ot">=</span><span class="cf">function</span>(x){<span class="fu">return</span>((x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x)<span class="sc">-</span><span class="fu">min</span>(x)))}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>X_s<span class="ot">=</span><span class="fu">apply</span>(X, <span class="dv">2</span>, mmsc)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>kv<span class="ot">=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">100</span> <span class="co">#these are the k values (k as in kNN) we will try</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>ndocv<span class="ot">=</span><span class="dv">10</span> <span class="co"># Number of cross validation</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 5-fold</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>cv_mat_5<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="fu">length</span>(kv),ndocv)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">#pb &lt;- txtProgressBar(min = 0, max = ndocv, style = 3) # Setting up the progress bar</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndocv){</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    cv_temp<span class="ot">=</span><span class="fu">docvknn</span>(X_s,medv,kv,<span class="at">nfold=</span><span class="dv">5</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    cv_mat_5[,i]<span class="ot">=</span><span class="fu">sqrt</span>(cv_temp<span class="sc">/</span><span class="fu">length</span>(medv))</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#setTxtProgressBar(pb, i)</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>cv_mean_5<span class="ot">=</span><span class="fu">apply</span>(cv_mat_5,<span class="dv">1</span>,mean)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>kbest_5 <span class="ot">=</span> kv[<span class="fu">which.min</span>(cv_mean_5)]</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The min value of RMSE for 5-fold cross-validation is associated with k="</span>,kbest_5,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The min value of RMSE for 5-fold cross-validation is associated with k= 7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 10-fold</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cv_mat_10<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="fu">length</span>(kv),ndocv)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#pb &lt;- txtProgressBar(min = 0, max = ndocv, style = 3) # Setting up the progress bar</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndocv){</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      cv_temp<span class="ot">=</span><span class="fu">docvknn</span>(X_s,medv,kv,<span class="at">nfold=</span><span class="dv">10</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      cv_mat_10[,i]<span class="ot">=</span><span class="fu">sqrt</span>(cv_temp<span class="sc">/</span><span class="fu">length</span>(medv))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">#setTxtProgressBar(pb, i)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>cv_mean_10<span class="ot">=</span><span class="fu">apply</span>(cv_mat_10,<span class="dv">1</span>,mean)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>kbest_10 <span class="ot">=</span> kv[<span class="fu">which.min</span>(cv_mean_10)]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The min value of RMSE for 10-fold cross-validation is associated with k="</span>,kbest_10,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The min value of RMSE for 10-fold cross-validation is associated with k= 5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kv, cv_mean_5, <span class="at">xlab=</span><span class="st">"K"</span>, <span class="at">ylab=</span><span class="st">"RMSE"</span>, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndocv) <span class="fu">lines</span>(kv,cv_mat_5[,i], <span class="at">col=</span><span class="dv">550</span><span class="sc">+</span>i, <span class="at">lwd=</span>.<span class="dv">4</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(kv, cv_mean_5, <span class="at">xlab=</span><span class="st">"K"</span>, <span class="at">ylab=</span><span class="st">"RMSE"</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"nfold=5"</span>, <span class="at">font.main=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kv, cv_mean_10, <span class="at">xlab=</span><span class="st">"K"</span>, <span class="at">ylab=</span><span class="st">"RMSE"</span>, <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndocv) <span class="fu">lines</span>(kv,cv_mat_10[,i], <span class="at">col=</span><span class="dv">550</span><span class="sc">+</span>i, <span class="at">lwd=</span>.<span class="dv">4</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(kv, cv_mean_10, <span class="at">xlab=</span><span class="st">"K"</span>, <span class="at">ylab=</span><span class="st">"RMSE"</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"nfold=10"</span>, <span class="at">font.main=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">##What is the best of way of measuring</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(medv,X_s)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>kf_best_5 <span class="ot">=</span> <span class="fu">kknn</span>(medv<span class="sc">~</span>.,data,data,<span class="at">k=</span>kbest_5,<span class="at">kernel =</span> <span class="st">"rectangular"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>RMSE_fold_5<span class="ot">=</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((data<span class="sc">$</span>medv<span class="sc">-</span>kf_best_5<span class="sc">$</span>fitted)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">length</span>(data<span class="sc">$</span>medv))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The RMSE for 5-fold kNN is"</span>, RMSE_fold_5,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE for 5-fold kNN is 4.01538 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>kf_best_10 <span class="ot">=</span> <span class="fu">kknn</span>(medv<span class="sc">~</span>.,data,data,<span class="at">k=</span>kbest_10,<span class="at">kernel =</span> <span class="st">"rectangular"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>RMSE_fold_10<span class="ot">=</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((data<span class="sc">$</span>medv<span class="sc">-</span>kf_best_10<span class="sc">$</span>fitted)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">length</span>(data<span class="sc">$</span>medv))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The RMSE for 10-fold kNN is"</span>, RMSE_fold_10,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The RMSE for 10-fold kNN is 3.786824 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lmf <span class="ot">=</span> <span class="fu">lm</span>(medv<span class="sc">~</span>.,data)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fmat <span class="ot">=</span> <span class="fu">cbind</span>(medv,lmf<span class="sc">$</span>fitted,kf_best_5<span class="sc">$</span>fitted,kf_best_10<span class="sc">$</span>fitted)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>my_line <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y,...){</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(x,y,...)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">segments</span>(<span class="fu">min</span>(x), <span class="fu">min</span>(y), <span class="fu">max</span>(x), <span class="fu">max</span>(y),...)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fmat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"y"</span>,<span class="st">"linear"</span>, <span class="st">"kNN5"</span>, <span class="st">"kNN10"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(fmat, <span class="at">lower.panel =</span> my_line, <span class="at">upper.panel =</span> my_line, <span class="at">col=</span><span class="st">'maroon'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="knn_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">cor</span>(fmat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               y    linear      kNN5     kNN10
y      1.0000000 0.7715306 0.9015274 0.9118707
linear 0.7715306 1.0000000 0.8534194 0.8376299
kNN5   0.9015274 0.8534194 1.0000000 0.9870313
kNN10  0.9118707 0.8376299 0.9870313 1.0000000</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./NaiveBayes.html" class="pagination-link" aria-label="Naive Bayes">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Naive Bayes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>